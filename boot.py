import json
import logging
import sqlite3
import time
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup
from telegram.ext import Application, CommandHandler, CallbackQueryHandler, MessageHandler, filters, ContextTypes

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(format='%(asctime)s - %(name)s - %(levelname)s - %(message)s', level=logging.INFO)
logger = logging.getLogger(__name__)

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö SQLite
def init_db():
    conn = sqlite3.connect('tool_rental.db', check_same_thread=False)
    c = conn.cursor()
    
    # –¢–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    c.execute('''CREATE TABLE IF NOT EXISTS users (
                    id INTEGER PRIMARY KEY,
                    name TEXT NOT NULL,
                    username TEXT,
                    orders_count INTEGER DEFAULT 0,
                    total_spent REAL DEFAULT 0.0,
                    join_date TEXT DEFAULT CURRENT_TIMESTAMP,
                    is_admin INTEGER DEFAULT 0)''')
    
    # –¢–∞–±–ª–∏—Ü–∞ –∑–∞–∫–∞–∑–æ–≤
    c.execute('''CREATE TABLE IF NOT EXISTS orders (
                    id INTEGER PRIMARY KEY,
                    user_id INTEGER,
                    items TEXT NOT NULL,
                    date TEXT NOT NULL,
                    total REAL NOT NULL,
                    address TEXT,
                    FOREIGN KEY (user_id) REFERENCES users (id))''')
    
    # –¢–∞–±–ª–∏—Ü–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
    c.execute('''CREATE TABLE IF NOT EXISTS tools (
                    id TEXT PRIMARY KEY,
                    name TEXT NOT NULL,
                    price REAL NOT NULL,
                    description TEXT,
                    image TEXT,
                    available INTEGER DEFAULT 1)''')
    
    # –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
    c.execute('CREATE INDEX IF NOT EXISTS idx_orders_user_id ON orders (user_id)')
    c.execute('CREATE INDEX IF NOT EXISTS idx_users_id ON users (id)')
    
    # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—á–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (10 —Ä–µ–∞–ª—å–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤)
    c.execute('SELECT COUNT(*) FROM tools')
    if c.fetchone()[0] == 0:
        initial_tools = [
            ("tool1", "–î—Ä–µ–ª—å Bosch GSB 13 RE", 20.0, "–ö–æ–º–ø–∞–∫—Ç–Ω–∞—è –¥—Ä–µ–ª—å —Å —É–¥–∞—Ä–æ–º", "https://www.bosch-professional.com/by/media/images/GSB_13_RE_Professional_product_main_1200x1200.png", 1),
            ("tool2", "–®—É—Ä—É–ø–æ–≤–µ—Ä—Ç Makita DF331D", 15.0, "–õ–µ–≥–∫–∏–π –∏ –º–æ—â–Ω—ã–π —à—É—Ä—É–ø–æ–≤–µ—Ä—Ç", "https://cdn.makitatools.com/media/catalog/product/cache/1/image/9df78eab33525d08d6e5fb8d27136e95/d/f/df331d_1.jpg", 1),
            ("tool3", "–ë–æ–ª–≥–∞—Ä–∫–∞ DeWalt DWE4233", 30.0, "–£–≥–ª–æ–≤–∞—è —à–ª–∏—Ñ–æ–≤–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞", "https://www.dewalt.com/NAG/PRODUCT/IMAGES/HIRES/DWE4233/DWE4233_1.jpg?resize=530,530", 1),
            ("tool4", "–ü–µ—Ä—Ñ–æ—Ä–∞—Ç–æ—Ä Hilti TE 30-AVR", 40.0, "–ú–æ—â–Ω—ã–π –ø–µ—Ä—Ñ–æ—Ä–∞—Ç–æ—Ä –¥–ª—è –±–µ—Ç–æ–Ω–∞", "https://www.hilti.by/medias/sys_master/images/hb3/hc9/9792581132318/TE-30-AVR-110V-2119170-Main-Image-Product-Image-518x345.jpg", 1),
            ("tool5", "–õ–æ–±–∑–∏–∫ Festool PS 420", 25.0, "–¢–æ—á–Ω—ã–π –ª–æ–±–∑–∏–∫ –¥–ª—è —Ä–µ–∑–∫–∏", "https://www.festoolusa.com/-/media/festool/us/products/cordless-jigsaws/ps-420-ebq-plus/ps-420-ebq-plus_561603_main.png", 1),
            ("tool6", "–ü–∏–ª–∞ —Ü–∏—Ä–∫—É–ª—è—Ä–Ω–∞—è Metabo KS 55", 35.0, "–ù–∞–¥–µ–∂–Ω–∞—è —Ü–∏—Ä–∫—É–ª—è—Ä–Ω–∞—è –ø–∏–ª–∞", "https://www.metabo.com/medias/600855000-KS-55-518x345.png", 1),
            ("tool7", "–®–ª–∏—Ñ–º–∞—à–∏–Ω–∞ Ryobi ROS300", 18.0, "–û—Ä–±–∏—Ç–∞–ª—å–Ω–∞—è —à–ª–∏—Ñ–º–∞—à–∏–Ω–∞", "https://images.thdstatic.com/product/image/ryobi-300w-random-orbit-sander-ros300-518x345.jpg", 1),
            ("tool8", "–¢—Ä–∏–º–º–µ—Ä Stihl FS 55", 45.0, "–ë–µ–Ω–∑–∏–Ω–æ–≤—ã–π —Ç—Ä–∏–º–º–µ—Ä –¥–ª—è —Ç—Ä–∞–≤—ã", "https://www.stihl.com/p/media/images/products/fs_55_r_518x345.jpg", 1),
            ("tool9", "–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä Honda EU22i", 60.0, "–ò–Ω–≤–µ—Ä—Ç–æ—Ä–Ω—ã–π –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä", "https://www.honda.co.uk/content/dam/central/power-products/generators/EU22i/EU22i-main.png", 1),
            ("tool10", "–ö–æ–º–ø—Ä–µ—Å—Å–æ—Ä Fubag VDC 400", 50.0, "–í–æ–∑–¥—É—à–Ω—ã–π –∫–æ–º–ø—Ä–µ—Å—Å–æ—Ä", "https://www.fubag.ru/upload/iblock/518/518x345_vdc_400_50_cm3.jpg", 1)
        ]
        c.executemany('INSERT INTO tools (id, name, price, description, image, available) VALUES (?, ?, ?, ?, ?, ?)', initial_tools)
        logger.info("–î–æ–±–∞–≤–ª–µ–Ω—ã 10 –Ω–∞—á–∞–ª—å–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö")
    
    conn.commit()
    conn.close()

# –§—É–Ω–∫—Ü–∏—è –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è
async def greet(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    user = update.effective_user
    conn = sqlite3.connect('tool_rental.db', check_same_thread=False)
    c = conn.cursor()
    
    ADMIN_ID = 6226570057  # –í–∞—à Telegram ID
    c.execute('SELECT * FROM users WHERE id = ?', (user.id,))
    if not c.fetchone():
        c.execute('INSERT INTO users (id, name, username, is_admin, join_date) VALUES (?, ?, ?, ?, ?)',
                 (user.id, user.full_name, user.username, 1 if user.id == ADMIN_ID else 0, time.strftime('%Y-%m-%d')))
        conn.commit()
        logger.info(f"–°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: {user.id}, –∞–¥–º–∏–Ω: {user.id == ADMIN_ID}")
    
    conn.close()
    
    keyboard = [
        [InlineKeyboardButton("–û—Ç–∫—Ä—ã—Ç—å –∫–∞—Ç–∞–ª–æ–≥", web_app={"url": "https://sait-vugf.onrender.com"})],
        [InlineKeyboardButton("–ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤", callback_data='history')],
        [InlineKeyboardButton("–ü—Ä–æ—Ñ–∏–ª—å", callback_data='profile')]
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)
    
    await update.message.reply_text(
        f"–ü—Ä–∏–≤–µ—Ç, {user.first_name}! üëã\n–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ø—Ä–µ–º–∏—É–º –ø—Ä–æ–∫–∞—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤.",
        reply_markup=reply_markup
    )

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Web App
async def web_app_data(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    try:
        user_id = update.effective_user.id
        data = json.loads(update.effective_message.web_app_data.data)
        action = data.get('action')
        if not action:
            raise ValueError("–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–æ–ª–µ 'action' –≤ –¥–∞–Ω–Ω—ã—Ö")
        
        logger.info(f"–ü–æ–ª—É—á–µ–Ω –∑–∞–ø—Ä–æ—Å –æ—Ç Web App: {action}, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: {user_id}")
        
        conn = sqlite3.connect('tool_rental.db', check_same_thread=False)
        c = conn.cursor()
        c.execute('SELECT is_admin FROM users WHERE id = ?', (user_id,))
        user = c.fetchone()
        if not user:
            c.execute('INSERT INTO users (id, name, username, is_admin, join_date) VALUES (?, ?, ?, ?, ?)',
                     (user_id, update.effective_user.full_name, update.effective_user.username, 0, time.strftime('%Y-%m-%d')))
            conn.commit()
            logger.info(f"–°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ Web App: {user_id}")
        is_admin = bool(user[0] if user else 0)

        if action == 'fetch_catalog':
            c.execute('SELECT id, name, price, description, image, available FROM tools')
            tools = [
                {
                    'id': row[0],
                    'name': row[1],
                    'price': float(row[2]),
                    'description': row[3] or '',
                    'image': row[4] or 'https://via.placeholder.com/150?text=Tool',
                    'available': bool(row[5]),
                    'rating': 4.8  # –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥ (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ –ë–î –ø–æ–∑–∂–µ)
                } for row in c.fetchall()
            ]
            response = {'action': 'catalog_data', 'tools': tools}
            logger.info(f"–û—Ç–ø—Ä–∞–≤–∫–∞ –∫–∞—Ç–∞–ª–æ–≥–∞: {len(tools)} –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤")
            await context.bot.send_message(chat_id=user_id, text=json.dumps(response, ensure_ascii=False))

        elif action == 'check_admin':
            logger.info(f"–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –¥–ª—è {user_id}: {is_admin}")
            await context.bot.send_message(chat_id=user_id, text=json.dumps({'action': 'admin_status', 'is_admin': is_admin}))

        elif action == 'add_tool' and is_admin:
            tool = data
            required_fields = ['name', 'price', 'description', 'image']
            if not all(field in tool for field in required_fields):
                raise ValueError("–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞")
            tool_id = f"tool_{int(time.time())}"
            c.execute('INSERT INTO tools (id, name, price, description, image, available) VALUES (?, ?, ?, ?, ?, ?)',
                     (tool_id, tool['name'], float(tool['price']), tool['description'], tool['image'], 1))
            conn.commit()
            logger.info(f"–î–æ–±–∞–≤–ª–µ–Ω –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç: {tool_id}")
            await context.bot.send_message(chat_id=user_id, text=json.dumps({'action': 'tool_added'}))

        elif action == 'edit_tool' and is_admin:
            tool = data
            required_fields = ['id', 'name', 'price', 'description', 'image', 'available']
            if not all(field in tool for field in required_fields):
                raise ValueError("–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞")
            c.execute('UPDATE tools SET name = ?, price = ?, description = ?, image = ?, available = ? WHERE id = ?',
                     (tool['name'], float(tool['price']), tool['description'], tool['image'], int(tool['available']), tool['id']))
            if c.rowcount == 0:
                raise ValueError(f"–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Å ID {tool['id']} –Ω–µ –Ω–∞–π–¥–µ–Ω")
            conn.commit()
            logger.info(f"–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç: {tool['id']}")
            await context.bot.send_message(chat_id=user_id, text=json.dumps({'action': 'tool_edited'}))

        elif action == 'delete_tool' and is_admin:
            tool_id = data.get('id')
            if not tool_id:
                raise ValueError("–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç ID –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è")
            c.execute('DELETE FROM tools WHERE id = ?', (tool_id,))
            if c.rowcount == 0:
                raise ValueError(f"–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Å ID {tool_id} –Ω–µ –Ω–∞–π–¥–µ–Ω")
            conn.commit()
            logger.info(f"–£–¥–∞–ª–µ–Ω –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç: {tool_id}")
            await context.bot.send_message(chat_id=user_id, text=json.dumps({'action': 'tool_deleted'}))

        elif action == 'place_order':
            order_id = data.get('id')
            items = data.get('items')
            total = float(data.get('total', 0))
            date = data.get('date')
            address = data.get('address', '–ù–µ —É–∫–∞–∑–∞–Ω')
            user_data = data.get('user', {})

            if not all([order_id, items, total, date]):
                raise ValueError("–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞")

            # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
            unavailable_tools = []
            for item in items:
                c.execute('SELECT available FROM tools WHERE id = ?', (item['tool_id'],))
                result = c.fetchone()
                if not result or not result[0]:
                    unavailable_tools.append(item['name'])
            if unavailable_tools:
                raise ValueError(f"–°–ª–µ–¥—É—é—â–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã: {', '.join(unavailable_tools)}")

            items_json = json.dumps(items, ensure_ascii=False)
            c.execute('INSERT INTO orders (id, user_id, items, date, total, address) VALUES (?, ?, ?, ?, ?, ?)',
                     (order_id, user_id, items_json, date, total, address))
            c.execute('UPDATE users SET orders_count = orders_count + 1, total_spent = total_spent + ? WHERE id = ?', (total, user_id))
            conn.commit()

            # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
            c.execute('UPDATE users SET name = ?, username = ? WHERE id = ?',
                     (user_data.get('name', ''), user_data.get('username', ''), user_id))
            conn.commit()

            items_text = "\n".join([f"{item['name']} - {item['days']} –¥–Ω., {item['quantity']} —à—Ç. ({item['total']} BYN)" for item in items])
            message = f"‚úÖ –ù–æ–≤—ã–π –∑–∞–∫–∞–∑ #{order_id}\n–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: {update.effective_user.first_name} (ID: {user_id})\n–î–∞—Ç–∞: {date}\n–ê–¥—Ä–µ—Å: {address}\n–¢–æ–≤–∞—Ä—ã:\n{items_text}\n–ò—Ç–æ–≥–æ: {total} BYN"
            await update.message.reply_text(message)

            # –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É
            ADMIN_ID = 6226570057
            if user_id != ADMIN_ID:
                await context.bot.send_message(chat_id=ADMIN_ID, text=message)
            logger.info(f"–°–æ–∑–¥–∞–Ω –∑–∞–∫–∞–∑ #{order_id} –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {user_id}")

        else:
            logger.warning(f"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ: {action} –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤")
            await context.bot.send_message(chat_id=user_id, text=json.dumps({'action': 'error', 'message': '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤'}))

        conn.close()

    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö Web App: {e}")
        await context.bot.send_message(chat_id=user_id, text=json.dumps({'action': 'error', 'message': str(e)}))

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–æ–∫
async def button(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    query = update.callback_query
    user_id = query.from_user.id
    await query.answer()
    
    conn = sqlite3.connect('tool_rental.db', check_same_thread=False)
    c = conn.cursor()

    if query.data == 'catalog':
        keyboard = [[InlineKeyboardButton("–û—Ç–∫—Ä—ã—Ç—å –∫–∞—Ç–∞–ª–æ–≥", web_app={"url": "https://sait-vugf.onrender.com"})]]
        await query.edit_message_text("–í—ã–±–µ—Ä–∏—Ç–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç:", reply_markup=InlineKeyboardMarkup(keyboard))

    elif query.data == 'history':
        c.execute('SELECT id, date, total, address FROM orders WHERE user_id = ?', (user_id,))
        orders = c.fetchall()
        if not orders:
            await query.edit_message_text("üìã –ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤ –ø—É—Å—Ç–∞")
        else:
            history_text = "\n".join([f"–ó–∞–∫–∞–∑ #{o[0]} –æ—Ç {o[1]} - {o[2]} BYN (–ê–¥—Ä–µ—Å: {o[3]})" for o in orders])
            await query.edit_message_text(f"üìã –ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤:\n{history_text}")

    elif query.data == 'profile':
        c.execute('SELECT name, orders_count, total_spent, is_admin, join_date FROM users WHERE id = ?', (user_id,))
        user = c.fetchone()
        profile_text = f"üë§ –ü—Ä–æ—Ñ–∏–ª—å\n–ò–º—è: {user[0]}\n–ó–∞–∫–∞–∑–æ–≤: {user[1]}\n–ü–æ—Ç—Ä–∞—á–µ–Ω–æ: {user[2]} BYN\n–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: {user[4]}\n–ê–¥–º–∏–Ω: {'–î–∞' if user[3] else '–ù–µ—Ç'}"
        await query.edit_message_text(profile_text)
    
    conn.close()

# –ö–æ–º–∞–Ω–¥–∞ /start
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    await greet(update, context)

def main() -> None:
    init_db()
    logger.info("–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞")
    
    application = Application.builder().token('7850457813:AAErLA5O4Q8wiPutwCcgUAnNDBJKSNNF9vQ').build()
    
    application.add_handler(CommandHandler("start", start))
    application.add_handler(MessageHandler(filters.Text(["–ø—Ä–∏–≤–µ—Ç", "–ü—Ä–∏–≤–µ—Ç", "–ü–†–ò–í–ï–¢"]), greet))
    application.add_handler(CallbackQueryHandler(button))
    application.add_handler(MessageHandler(filters.StatusUpdate.WEB_APP_DATA, web_app_data))
    
    application.run_polling()

if __name__ == '__main__':
    main()